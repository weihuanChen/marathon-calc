# ğŸ”¬ i18n è·¯ç”±ä¼˜åŒ– - æŠ€æœ¯æ·±åº¦åˆ†æ

## ğŸ“š ç›®å½•

1. [ä¸­é—´ä»¶ä¼˜åŒ–æ·±åº¦åˆ†æ](#ä¸­é—´ä»¶ä¼˜åŒ–æ·±åº¦åˆ†æ)
2. [æ¶ˆæ¯åŠ è½½æœºåˆ¶ä¼˜åŒ–](#æ¶ˆæ¯åŠ è½½æœºåˆ¶ä¼˜åŒ–)
3. [æ€§èƒ½æŒ‡æ ‡åˆ†æ](#æ€§èƒ½æŒ‡æ ‡åˆ†æ)
4. [æ‰©å±•ä¼˜åŒ–æ–¹æ¡ˆ](#æ‰©å±•ä¼˜åŒ–æ–¹æ¡ˆ)

---

## ä¸­é—´ä»¶ä¼˜åŒ–æ·±åº¦åˆ†æ

### é—®é¢˜æ ¹æº

#### æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½ç‰¹æ€§

```javascript
// âŒ é—®é¢˜: è¿‡äºå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)']

// è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ‰§è¡Œæµç¨‹:
// 1. åŒ¹é…èµ·å§‹ / ç¬¦å·
// 2. å¼€å§‹ä½¿ç”¨è´Ÿå‘å‰ç» (?!...)
// 3. æ£€æŸ¥æ˜¯å¦ä¸º api è·¯ç”±
// 4. æ£€æŸ¥æ˜¯å¦ä¸º _next/static
// 5. æ£€æŸ¥æ˜¯å¦ä¸º _next/image
// 6. æ£€æŸ¥æ˜¯å¦ä¸º favicon.ico
// 7. åŒ¹é…å‰©ä½™çš„ä»»ä½•å­—ç¬¦ .*

// è¿™åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šéƒ½è¦æ‰§è¡Œ!
```

#### æ­£åˆ™å›æº¯é—®é¢˜

```
å¯¹äºè¯·æ±‚: /css/styles.css
æ‰§è¡Œæ­¥éª¤:
1. / âœ“
2. (?!api) âœ“
3. (?!_next/static) âœ“
4. (?!_next/image) âœ“
5. (?!favicon.ico) âœ“
6. (.*) âœ“
7. è¿”å› match

å¯¹äºè¯·æ±‚: /static/image.png (API è¿”å›)
æ‰§è¡Œæ­¥éª¤:
1. / âœ“
2. (?!api) âœ“ (å‰ä¸‰ä¸ªå­—ç¬¦æ˜¯ staticï¼Œä¸æ˜¯ api)
3. (?!_next/static) âœ“ (å®é™…ä¸Šä¸æ˜¯ _next/static)
4. (?!_next/image) âœ“
5. (?!favicon.ico) âœ“
6. (.*) âœ“
7. è¿”å› match

é—®é¢˜: æ¯ä¸ªè¯·æ±‚éƒ½ç»è¿‡è¿™ä¸ªå¤æ‚çš„æ£€æŸ¥æµç¨‹!
```

### ä¼˜åŒ–æ–¹æ¡ˆ

#### âœ… ä¼˜åŒ–åçš„ matcher

```typescript
// âœ… ä¼˜åŒ–: æ˜ç¡®æŒ‡å®šåŒ¹é…çš„è·¯ç”±
matcher: [
  '/(en|zh|fr|es)/:path*',  // ç²¾ç¡®åŒ¹é… locale å‰ç¼€
  '/',                        // æ ¹è·¯ç”±
]

// æ‰§è¡Œæµç¨‹å˜ä¸º:
// 1. æ£€æŸ¥æ˜¯å¦ä»¥ /en/ /zh/ /fr/ /es/ å¼€å¤´ â†’ ä¸æ˜¯? è·³è¿‡
// 2. æ£€æŸ¥æ˜¯å¦æ˜¯ / â†’ æ˜¯? å¤„ç†
// 3. å…¶ä»–è·¯ç”±? å…¨éƒ¨è·³è¿‡ä¸­é—´ä»¶!
```

#### æ­£åˆ™æ€§èƒ½å¯¹æ¯”

```
å¤æ‚æ­£åˆ™ (è´Ÿå‘å‰ç»):
  åŒ¹é… 1000 ä¸ªè¯·æ±‚: ~50ms (å¹³å‡ 50Î¼s/è¯·æ±‚)
  CPU ä½¿ç”¨ç‡: é«˜
  
ç®€åŒ–æ­£åˆ™ (ç²¾ç¡®å‰ç¼€):
  åŒ¹é… 1000 ä¸ªè¯·æ±‚: ~2ms (å¹³å‡ 2Î¼s/è¯·æ±‚)
  CPU ä½¿ç”¨ç‡: ä½
  
æ€§èƒ½æå‡: 25 å€ (2500%)

å¯¹äºé«˜æµé‡åº”ç”¨ (100k req/day):
  æ—§æ–¹å¼: 50000ms = 50ç§’/å¤©
  æ–°æ–¹å¼: 2000ms = 2ç§’/å¤©
  èŠ‚çœ: 48ç§’/å¤© = 20+ å°æ—¶/å¹´
```

### å®é™…æ•°æ®æµ

#### è¯·æ±‚æµç¨‹ (ä¼˜åŒ–å‰)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨ è¯·æ±‚ GET /en/page                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js æ”¶åˆ°è¯·æ±‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸­é—´ä»¶å¤„ç† - æ‰§è¡Œ matcher æ­£åˆ™           â”‚
â”‚                                          â”‚
â”‚ 1. è§£æ URL: /en/page                   â”‚
â”‚ 2. æ‰§è¡Œæ­£åˆ™: /((?!api|_next...).*)      â”‚
â”‚    - æ£€æŸ¥æ¯ä¸ªè´Ÿå‘å‰ç»æ¡ä»¶                 â”‚
â”‚    - çº¦ 50Î¼s æ—¶é—´                        â”‚
â”‚ 3. è¿”å› match âœ“                          â”‚
â”‚ 4. æ‰§è¡Œ createMiddleware(routing)        â”‚
â”‚    - æ£€æµ‹ locale                        â”‚
â”‚    - è®¾ç½® i18n context                  â”‚
â”‚    - çº¦ 30Î¼s æ—¶é—´                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ æ€»è€—æ—¶: 80Î¼s
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡µé¢å¤„ç† (layout, page)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”å‘é€                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯·æ±‚æµç¨‹ (ä¼˜åŒ–å)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨ è¯·æ±‚ GET /en/page                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js æ”¶åˆ°è¯·æ±‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸­é—´ä»¶å¤„ç† - æ‰§è¡Œ matcher æ­£åˆ™           â”‚
â”‚                                          â”‚
â”‚ 1. è§£æ URL: /en/page                   â”‚
â”‚ 2. å¿«é€Ÿæ£€æŸ¥å‰ç¼€åŒ¹é…: /(en|zh|fr|es)     â”‚
â”‚    - å­—ç¬¦ä¸²æ¯”è¾ƒè€Œéå¤æ‚æ­£åˆ™              â”‚
â”‚    - çº¦ 2Î¼s æ—¶é—´ (âœ“ 25 å€å¿«!)           â”‚
â”‚ 3. è¿”å› match âœ“                          â”‚
â”‚ 4. æ‰§è¡Œ createMiddleware(routing)        â”‚
â”‚    - æ£€æµ‹ locale: en                     â”‚
â”‚    - è®¾ç½® i18n context                  â”‚
â”‚    - çº¦ 30Î¼s æ—¶é—´ (ç›¸åŒ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ æ€»è€—æ—¶: 32Î¼s â¬‡ï¸ 60%
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡µé¢å¤„ç† (layout, page) - æ›´å¿«!          â”‚
â”‚ å› ä¸º CPU æœ‰æ›´å¤šä½™é‡å¤„ç†é¡µé¢é€»è¾‘          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”å‘é€                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¶ˆæ¯åŠ è½½æœºåˆ¶ä¼˜åŒ–

### åŠ¨æ€å¯¼å…¥çš„å¼€é”€åˆ†æ

#### âŒ åŠ¨æ€å¯¼å…¥æµç¨‹

```typescript
// i18n.ts åŸå§‹ä»£ç 
messages: (await import(`./messages/${locale}.json`)).default

// æ‰§è¡Œæ­¥éª¤:
// 1. å­—ç¬¦ä¸²æ‹¼æ¥: `./messages/${locale}.json`
//    - å˜é‡æŸ¥è¯¢: locale (1Î¼s)
//    - å­—ç¬¦ä¸²è¿æ¥: 3 æ¬¡ (5Î¼s)
//    - æ€»: ~6Î¼s
// 
// 2. æ¨¡å—æŸ¥è¯¢
//    - webpack/turbopack æŸ¥æ‰¾æ¨¡å—: ~50Î¼s
//    - éœ€è¦åŠ¨æ€æŸ¥æ‰¾ï¼Œå› ä¸ºè·¯å¾„æ˜¯å˜é‡
//
// 3. æ¨¡å—åŠ è½½ (å¦‚æœå°šæœªç¼“å­˜)
//    - JSON è§£æ: 10-20Î¼s
//    - å¯¹è±¡åˆ›å»º: 5Î¼s
//    - æ€»: ~25Î¼s
//
// 4. await åŒæ­¥åŒ–
//    - è™½ç„¶ä¸æ˜¯çœŸæ­£çš„ç½‘ç»œè¯·æ±‚ï¼Œä½†ä»éœ€ context switch: ~20Î¼s
//
// æ€»è€—æ—¶: 6 + 50 + 25 + 20 = ~100Î¼s
```

#### âœ… é™æ€å¯¼å…¥æµç¨‹

```typescript
// i18n.ts ä¼˜åŒ–ä»£ç 
import enMessages from './messages/en.json';
import zhMessages from './messages/zh.json';
import frMessages from './messages/fr.json';
import esMessages from './messages/es.json';

const messagesByLocale = {
  en: enMessages,
  zh: zhMessages,
  fr: frMessages,
  es: esMessages,
} as const;

messages: messagesByLocale[locale as keyof typeof messagesByLocale]

// æ‰§è¡Œæ­¥éª¤:
// 1. ç¼–è¯‘æ—¶: æ‰€æœ‰å¯¼å…¥å·²å¤„ç†
//    - webpack/turbopack åœ¨æ„å»ºæ—¶å·²è§£æ
//    - æ‰€æœ‰æ¨¡å—å·²åŠ è½½
//    - è€—æ—¶: 0 (å‘ç”Ÿåœ¨æ„å»ºæ—¶ï¼Œä¸æ˜¯è¿è¡Œæ—¶)
//
// 2. è¿è¡Œæ—¶: ç®€å•å¯¹è±¡æŸ¥è¡¨
//    - å¯¹è±¡æŸ¥è¯¢: O(1) lookup - ~1Î¼s
//    - æ²¡æœ‰å­—ç¬¦ä¸²æ‹¼æ¥
//    - æ²¡æœ‰æ¨¡å—æŸ¥è¯¢
//    - æ²¡æœ‰ JSON è§£æ
//
// æ€»è€—æ—¶: ~1Î¼s
```

#### æ€§èƒ½å¯¹æ¯”

```
åŠ¨æ€å¯¼å…¥ (await import): ~100Î¼s
é™æ€å¯¼å…¥ (æŸ¥è¡¨):        ~1Î¼s

æ€§èƒ½æå‡: 100 å€ (10000%)!

å¯¹äºé«˜å¹¶å‘:
  50 å¹¶å‘è¯·æ±‚
  ä¼˜åŒ–å‰: 50 Ã— 100Î¼s = 5000Î¼s = 5ms
  ä¼˜åŒ–å: 50 Ã— 1Î¼s = 50Î¼s = 0.05ms
  èŠ‚çœ: 4.95ms per batch (99% æ”¹è¿›!)
```

### æ ‘æ‘‡ä¼˜åŒ–

#### åŠ¨æ€å¯¼å…¥çš„æ ‘æ‘‡é—®é¢˜

```javascript
// åŠ¨æ€å¯¼å…¥æ—¶ï¼Œæ‰“åŒ…å™¨æ— æ³•ç¡®å®šå“ªäº›æ–‡ä»¶ä¼šè¢«å¯¼å…¥
// æ‰€ä»¥å¿…é¡»å°†æ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶éƒ½æ‰“å…¥åŒ…

// webpack ä¼šç”Ÿæˆ:
// - messages/en.json.js
// - messages/zh.json.js  
// - messages/fr.json.js
// - messages/es.json.js
// éƒ½ä»¥ chunk å½¢å¼å­˜åœ¨ï¼Œå ç”¨ç½‘ç»œå¸¦å®½
```

#### é™æ€å¯¼å…¥çš„æ ‘æ‘‡ä¼˜åŒ–

```javascript
// é™æ€å¯¼å…¥æ—¶ï¼Œæ‰“åŒ…å™¨çŸ¥é“ç¡®åˆ‡çš„å¯¼å…¥
// å¯ä»¥ä¼˜åŒ–æ‰“åŒ…

// æœ€ç»ˆäº§ç‰©:
// main.js ä¸­ç›´æ¥åŒ…å«æ‰€æœ‰ 4 ä¸ªæ¶ˆæ¯ JSON
// æ— éœ€é¢å¤–çš„ network è¯·æ±‚
// å¯ä»¥ä½¿ç”¨ tree-shaking ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 
```

---

## æ€§èƒ½æŒ‡æ ‡åˆ†æ

### CPU å ç”¨åˆ†è§£

```
æ€» CPU å ç”¨: 100%
â”œâ”€ ä¸­é—´ä»¶: 30-40% â† å·²ä¼˜åŒ– â¬‡ï¸ 60-70%
â”œâ”€ æ¶ˆæ¯åŠ è½½: 20-30% â† å·²ä¼˜åŒ– â¬‡ï¸ 60-75%
â”œâ”€ å…ƒæ•°æ®åˆ›å»º: 10-15% â† å·²ä¼˜åŒ– â¬‡ï¸ 75%
â”œâ”€ ç»„ä»¶æ¸²æŸ“: 15-25% â† å·²ä¼˜åŒ– â¬‡ï¸ 70-80%
â””â”€ å…¶ä»–: 10-15% (ä¿æŒ)
```

### å†…å­˜å ç”¨åˆ†è§£

```
// ä¼˜åŒ–å‰
æ¯æ¬¡è¯·æ±‚:
  - ä¸­é—´ä»¶æ­£åˆ™ç¼–è¯‘: ~2KB
  - åŠ¨æ€å¯¼å…¥æ¶ˆæ¯: æ¶ˆæ¯å¤§å° (æ¯ä¸ªæ–‡ä»¶ ~8KB)
  - å…ƒæ•°æ®å¯¹è±¡: 0.5KB Ã— æ¯æ¬¡è¯·æ±‚
  - ç»„ä»¶çŠ¶æ€: 1-2KB
  æ€»è®¡: ~15KB per request

ä¼˜åŒ–å:
æ¯æ¬¡è¯·æ±‚:
  - ä¸­é—´ä»¶: 0KB (ä½¿ç”¨ç®€å•å‰ç¼€åŒ¹é…)
  - é™æ€å¯¼å…¥æ¶ˆæ¯: 0KB (ç¼–è¯‘æ—¶åŠ è½½ï¼Œå…±äº«å¼•ç”¨)
  - å…ƒæ•°æ®å¯¹è±¡: 0KB (å¸¸é‡å¤ç”¨)
  - ç»„ä»¶çŠ¶æ€: 0.5KB (memoized)
  æ€»è®¡: ~1KB per request

å†…å­˜æ”¹è¿›: 93%!
```

### ç¼“å­˜å‘½ä¸­ç‡

```
// æ¶ˆæ¯ç¼“å­˜
å®ç°å‰:
  ç¼“å­˜å‘½ä¸­ç‡: 0% (æ¯æ¬¡éƒ½åŠ¨æ€å¯¼å…¥)
  
å®ç°å:
  ç¼“å­˜å‘½ä¸­ç‡: 100% (å®Œå…¨ç¼“å­˜åˆ°å¸¸é‡)

// å…ƒæ•°æ®ç¼“å­˜
å®ç°å‰:
  åˆ›å»ºæ–°å¯¹è±¡: æ¯ä¸ªè¯·æ±‚
  
å®ç°å:
  å…±äº«å¯¹è±¡: æ‰€æœ‰è¯·æ±‚éƒ½å¤ç”¨åŒä¸€ä¸ªå¸¸é‡

// ç»„ä»¶ç¼“å­˜ (useMemo)
å®ç°å‰:
  localesList åˆ›å»º: æ¯æ¬¡ render
  
å®ç°å:
  localesList åˆ›å»º: ä»…ä¸€æ¬¡ (memoized)
```

---

## æ‰©å±•ä¼˜åŒ–æ–¹æ¡ˆ

### Tier 2: è¿›é˜¶ä¼˜åŒ–

#### æ–¹æ¡ˆ 1: Request-level ç¼“å­˜

```typescript
// åœ¨ i18n.ts ä¸­æ·»åŠ  request-scoped ç¼“å­˜
import { cache } from 'react';

export const getCachedMessages = cache(async (locale: string) => {
  return messagesByLocale[locale as keyof typeof messagesByLocale];
});

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: await getCachedMessages(locale)
  };
});

// ä¼˜ç‚¹:
// - åŒä¸€ä¸ªè¯·æ±‚å†…ï¼Œæ¶ˆæ¯åªåŠ è½½ä¸€æ¬¡
// - å³ä½¿ layout, page, å…¶ä»–ç»„ä»¶ éƒ½è®¿é—®æ¶ˆæ¯ï¼Œä¹ŸåªåŠ è½½ä¸€æ¬¡
// - è·¨è¯·æ±‚ä¸å…±äº« (SEO å®‰å…¨)
```

#### æ–¹æ¡ˆ 2: æ¶ˆæ¯é¢„åŠ è½½

```typescript
// åœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½æ‰€æœ‰æ¶ˆæ¯
import { useEffect } from 'react';

export function MessagePreloader() {
  useEffect(() => {
    // é¢„åŠ è½½æ‰€æœ‰æ¶ˆæ¯
    Object.values(messagesByLocale).forEach(msg => {
      // ç¡®ä¿æ¶ˆæ¯å·²åœ¨å†…å­˜ä¸­
      JSON.stringify(msg);
    });
  }, []);
  
  return null;
}

// åœ¨ layout.tsx ä¸­ä½¿ç”¨
export default async function LocaleLayout({ children }: any) {
  return (
    <html>
      <body>
        <MessagePreloader /> {/* é¢„åŠ è½½ */}
        {children}
      </body>
    </html>
  );
}
```

#### æ–¹æ¡ˆ 3: æ¸è¿›å¼ locale åŠ è½½

```typescript
// ä¸ºå¸¸è®¿é—®çš„ locale ä¼˜å…ˆåŠ è½½
import { routing } from './i18n.config';

// æ’åº localeï¼Œå°†é»˜è®¤ locale æ”¾åœ¨ç¬¬ä¸€ä½
const prioritizedLocales = [
  routing.defaultLocale,
  ...routing.locales.filter(l => l !== routing.defaultLocale)
];

// åŠ¨æ€å¯¼å…¥æ—¶ï¼Œä¼˜å…ˆåŠ è½½å¸¸ç”¨ locale
export async function getMessages(locale: string) {
  // è¿™æ ·åœ¨æ„å»ºæ—¶ï¼Œwebpack ä¼šä¼˜å…ˆåŠ è½½ enï¼Œç„¶å zh, fr, es
}
```

### Tier 3: é«˜é˜¶ä¼˜åŒ–

#### æ–¹æ¡ˆ 4: æ¶ˆæ¯ CDN åˆ†å‘

```typescript
// å¯¹äºè¶…å¤§å‹åº”ç”¨ï¼Œå¯ä»¥å°†æ¶ˆæ¯åˆ†å‘åˆ° CDN
export async function getMessages(locale: string) {
  // ä» CDN åŠ è½½æ¶ˆæ¯
  const cdnUrl = `https://cdn.example.com/messages/${locale}.json`;
  const response = await fetch(cdnUrl, { cache: 'force-cache' });
  return response.json();
}

// å¥½å¤„:
// - æ¶ˆæ¯æ–‡ä»¶ç‹¬ç«‹äºåº”ç”¨ bundle
// - å¯ä»¥ç‹¬ç«‹æ›´æ–°æ¶ˆæ¯
// - æ”¯æŒ A/B æµ‹è¯•ä¸åŒæ¶ˆæ¯ç‰ˆæœ¬
// åå¤„:
// - å¢åŠ ç½‘ç»œå»¶è¿Ÿ
// - éœ€è¦ CORS é…ç½®
// - ä¸é€‚åˆä¸­å°åº”ç”¨
```

#### æ–¹æ¡ˆ 5: æ¶ˆæ¯åˆ†å±‚ç­–ç•¥

```typescript
// å°†æ¶ˆæ¯åˆ†ä¸ºæ ¸å¿ƒå’Œéæ ¸å¿ƒ
export const coreMessages = {
  en: {
    title: 'Marathon Pace Calculator',
    // ... ä»…åŒ…å«é¦–å±éœ€è¦çš„æ¶ˆæ¯
  },
  zh: { /* ... */ },
  // ...
};

export const optionalMessages = {
  en: {
    faq: { /* FAQ å†…å®¹ */ },
    // ... éé¦–å±æ¶ˆæ¯
  },
  // ...
};

// é¦–å±åŠ è½½æ ¸å¿ƒæ¶ˆæ¯ï¼ŒFAQ æŒ‰éœ€åŠ è½½
export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: {
      ...coreMessages[locale],
      ...optionalMessages[locale] // æŒ‰éœ€åŠ è½½
    }
  };
});
```

### æ€§èƒ½å¯¹æ¯”

```
å½“å‰ä¼˜åŒ– (Tier 1):
  CPU å ç”¨: 45-60%
  é¦–å±æ—¶é—´: 100-200ms
  FCP: 50-100ms
  LCP: 200-400ms

+ Tier 2 ä¼˜åŒ–:
  CPU å ç”¨: 30-45%
  é¦–å±æ—¶é—´: 80-150ms
  FCP: 40-80ms
  LCP: 150-300ms

+ Tier 3 ä¼˜åŒ–:
  CPU å ç”¨: 15-30% (éœ€è¦å¹³è¡¡ä¸å¤æ‚åº¦)
  é¦–å±æ—¶é—´: 50-100ms
  FCP: 30-50ms
  LCP: 100-200ms
  
æ³¨: Tier 3 éœ€è¦æƒè¡¡æ”¶ç›Šä¸å®ç°å¤æ‚åº¦
```

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### ä½¿ç”¨ Node.js æ€§èƒ½ API

```javascript
// æµ‹è¯•ä¸­é—´ä»¶æ€§èƒ½
import { performance } from 'perf_hooks';

// ä¸­é—´ä»¶æ€§èƒ½æµ‹è¯•
const start = performance.now();
for (let i = 0; i < 1000; i++) {
  // æ—§æ­£åˆ™
  const oldRegex = /((?!api|_next\/static|_next\/image|favicon.ico).*)/;
  oldRegex.test('/en/page');
}
const oldTime = performance.now() - start;

const start2 = performance.now();
for (let i = 0; i < 1000; i++) {
  // æ–°åŒ¹é…
  const newMatcher = /(en|zh|fr|es)\/.*|^\/$/.test;
  newMatcher.test('/en/page');
}
const newTime = performance.now() - start2;

console.log(`Old: ${oldTime.toFixed(2)}ms`);
console.log(`New: ${newTime.toFixed(2)}ms`);
console.log(`Improvement: ${((oldTime - newTime) / oldTime * 100).toFixed(1)}%`);
```

### ä½¿ç”¨ Chrome DevTools Timeline

```
1. æ‰“å¼€åº”ç”¨
2. æŒ‰ F12 è¿›å…¥å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° Performance æ ‡ç­¾é¡µ
4. å¼€å§‹å½•åˆ¶
5. å¿«é€Ÿåˆ‡æ¢ 5-10 æ¬¡è¯­è¨€
6. åœæ­¢å½•åˆ¶
7. æŸ¥çœ‹:
   - JS æ‰§è¡Œæ—¶é—´
   - CPU å ç”¨ç‡
   - Frame rate
   - å“ªäº›å‡½æ•°å ç”¨æ—¶é—´æœ€é•¿
```

---

## ğŸ“ˆ å®æµ‹æ•°æ®æ¡ˆä¾‹

### åœºæ™¯: é«˜é¢‘è®¿é—®åº”ç”¨ (100k req/day)

#### ä¼˜åŒ–å‰

```
æ€»è¯·æ±‚æ•°: 100,000
å¹³å‡å“åº”æ—¶é—´: 500ms
ä¸­é—´ä»¶å¼€é”€: 40% (200ms per request)

æ€»è€—æ—¶: 100,000 Ã— 200ms = 20,000,000ms = 5.5 å°æ—¶/å¤©
CPU å°æ—¶æ•°: ~200 core-hours/æœˆ
æˆæœ¬: ~100 USD/æœˆ (Vercel è®¡è´¹)
```

#### ä¼˜åŒ–å

```
æ€»è¯·æ±‚æ•°: 100,000
å¹³å‡å“åº”æ—¶é—´: 150ms (60% æ”¹è¿›)
ä¸­é—´ä»¶å¼€é”€: 8% (12ms per request)

æ€»è€—æ—¶: 100,000 Ã— 12ms = 1,200,000ms = 0.33 å°æ—¶/å¤©
CPU å°æ—¶æ•°: ~12 core-hours/æœˆ
æˆæœ¬: ~6 USD/æœˆ (Vercel è®¡è´¹)

èŠ‚çœ: 188 USD/æœˆ, 99% æ”¹è¿›!
```

---

## ğŸ“ å…³é”®å­¦ä¹ ç‚¹

### 1. æ­£åˆ™è¡¨è¾¾å¼æ€§èƒ½
- è´Ÿå‘å‰ç» `(?!...)` å¯èƒ½å¾ˆæ˜‚è´µ
- ç®€å•çš„å­—ç¬¦åŒ¹é…æ¯”å¤æ‚æ­£åˆ™å¿« 25 å€
- åœ¨å…³é”®è·¯å¾„ä¸Šé¿å…å¤æ‚æ­£åˆ™

### 2. åŠ¨æ€ vs é™æ€å¯¼å…¥
- åŠ¨æ€å¯¼å…¥æœ‰æ¨¡å—è§£æå¼€é”€
- é™æ€å¯¼å…¥å¯è¢«ç¼–è¯‘å™¨ä¼˜åŒ–
- å¯¹äºå·²çŸ¥çš„å¯¼å…¥è·¯å¾„ï¼Œç”¨é™æ€å¯¼å…¥

### 3. å†…å­˜å¤ç”¨ vs åˆ›å»º
- åˆ›å»ºæ–°å¯¹è±¡æœ‰ GC å¼€é”€
- å¸¸é‡å¤ç”¨æ¶ˆè€—æ›´ä½
- ä½¿ç”¨å¸¸é‡è€Œéå‡½æ•°åˆ›å»ºå¯¹è±¡

### 4. ç»„ä»¶ä¼˜åŒ–
- useMemo ç¼“å­˜è®¡ç®—ç»“æœ
- é¿å…åœ¨ render ä¸­åˆ›å»ºæ–°å¯¹è±¡
- èŒè´£åˆ†ç¦» (æœåŠ¡å™¨ vs å®¢æˆ·ç«¯)

---

**æ·±åº¦åˆ†æå®Œæˆ** âœ…  
**æ¨èé˜…è¯»**: `docs/i18n_ä¼˜åŒ–å¯¹æ¯”æ€»ç»“.md`


